packages:
#                                                          #
#                                          ALL PREFERENCES #
#                                                          #
  all:
{% if 'target' in tokens %}
    target: [{{tokens['target']}}]
{% endif %}
#                                                          #
#                                                PROVIDERS #
#                                                          #
#    providers:
#      mpi: [mvapich2]
# {% for lib, provider in data['providers'].items() %}     #
#       {{ lib }}: {{ provider }}                          # 
# {% endfor %}                                             # 
#                                                          #
#                                         DEFAULT PACKAGES #
#                                                          #
  mesa:
    variants: ~llvm
  openmpi:
    version: [4.1.3]
    variants: +memchecker +pmi fabrics=ucx schedulers=slurm
{% for pkg, definition in data['defaults'].items() %}
{% if pkg not in data['externals'] %}
  {{ pkg }}:
{% for key, value in definition.items() %}
    {{ key }}: {{ value }}
{% endfor %}
{% endif %}
{% endfor %}
#                                                          #
#                                        EXTERNAL PACKAGES #
#                                                          #
{% for pkg, definition in data['externals'].items() %}
  {{ pkg }}:
{% if pkg in data['defaults'] %}
{% for key, value in data['defaults'][pkg].items() %}
    {{ key }}: {{ value }}
{% endfor %}
{% endif %}
    externals:
{% for spec in definition %}
    - {{ spec }}
{% endfor %}
{% endfor %}
