--- # ------------------------------------------------------------------------------
# ------------------------------------------------------------------------------
# PROGRAMMING ENVIRONMENT SECTION (PE)
#
# The PR section follows the syntax: <pe_name>_<stack_name>_<package_name>.
# for example: intel_stable_compiler. There is a parent child schema that must
# be respected. The metadata key is ignored for this purpose. The core PE only
# has one information and does not follow the same schema. Any key under the
# <package_name> will be seen as a filter or it will be ignored. In the future
# we may need to introduce a stack key and a dependencies key for the case where
# we want to compile the compiler or stack libraries with GPU support. For now,
# the core_compiler should have this name (this means 'core' key and 'compiler'
# for subkey. We can also set section:core for the core PE.
core:
  metadata:
    section: core
  compiler: <core_compiler>

intel:
  metadata:
    section: pe
  stable:
    compiler: intel@20.0.4
    mpi: intel-mpi@2019.10.317
    blas: intel-mkl@2020.4.304
    python3: python@<python3> +tkinter +optimization ^freetype@2.7.1 ^fontconfig@2.12.3

gcc:
  metadata:
    section: pe
  stable:
    compiler: gcc@12.1.0
    mpi:
      infiniband: mvapich2 fabrics=mrail process_managers=slurm threads=multiple @2.3.7
      ethernet: mvapich2 fabrics=tcp,self process_managers=slurm threads=multiple @2.3.7
    blas: openblas@0.3.20 threads=none +locking
    python3: python@<python3> +tkinter +optimization ~debug
    python2: python@2.7.18 +tkinter ~debug

# ------------------------------------------------------------------------------
# PACKAGES SECTION
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# Core packages: compiled with the system compiler
core_packages:
  metadata:
    section: packages
  pe:
    - core
  packages:
    - cmake
    - curl
    - git
    - git-lfs
    - i7z
    - libtool
    - lmod
    - m4
    - tmux

# ------------------------------------------------------------------------------
# Serial Packages: do not depend on MPI
serial_packages:
  metadata:
    section: packages
  pe:
    - gcc_stable
    - intel_stable
  packages:
    - fftw +openmp ~mpi
    - gsl
    - hdf5 ~mpi:
        default: { variants: +szip +hl +fortran +cxx }
    - hisat2
    - metis:
        default: { variants: +real64 }
    - muscle
    - netcdf-c ~mpi ^hdf5 ~mpi
    - netcdf-fortran ~mpi ^netcdf-c ~mpi ^hdf5 ~mpi
    - scotch ~mpi:
        default: { variants: +esmumps ~metis }

# ------------------------------------------------------------------------------
# BLAS/LAPACK dependant packages
serial_packages_blas:
  metadata:
    section: packages
  pe:
    - gcc_stable
    - intel_stable
  dependencies:
    - blas
  packages:
    - arpack-ng~mpi
    - gmsh ~mpi +hdf5 +cgns +eigen +opencascade +openmp
    - ncview:
        dependencies:
          - netcdf-c~mpi
    - superlu

serial_packages_blas_gpu:
  metadata:
    section: packages
  pe:
    - gcc_stable
    - intel_stable
  dependencies:
    - blas
    - gpu
  packages:
    - suite-sparse:
        variants:
          gpu:
            nvidia: +cuda cuda_arch=<cuda_arch>
            none: ~cuda
    - magma:
        variants:
          gpu:
            nvidia: +cuda cuda_arch=<cuda_arch>

serial_packages_python:
  metadata:
    section: packages
  pe:
    - gcc_stable
    - intel_stable
  dependencies:
    - blas
  packages:
    - boost ~mpi:
        default: { variants: cxxstd=14 +icu +python +numpy }
    - cairo:
        default: { variants: +png +pdf +fc +ft }
    - hwloc +cairo:
        variants:
          gpu:
            nvidia: +cuda +nvml
            none: ~cuda
    - mercurial
    - ninja
    - prinseq-lite
    - py-pybind11
    - py-scikit-learn

serial_packages_python_activated:
  metadata:
    section: packages
    modules:
      blacklist: True
    activated: True
  pe:
    - gcc_stable
    - intel_stable
  dependencies:
    - blas
  packages:
    - py-absl-py
    - py-astunparse
    - py-cython
    - py-gast
    - py-google-pasta
    - py-grpcio
    - py-keras-preprocessing
    - py-matplotlib
    - py-numpy
    - py-opt-einsum
    - py-pandas
    - py-pip
    - py-ply
    - py-protobuf
    - py-requests
    - py-scipy
    - py-semver
    - py-six
    - py-sympy
    - py-termcolor
    - py-virtualenv
    - py-wheel
    - py-wrapt
    - py-xarray

mpi_packages:
  metadata:
    section: packages
  pe:
    - gcc_stable
    - intel_stable
  dependencies:
    - mpi
  packages:
    - arpack-ng:
        default: { variants: +mpi }
    - fftw +mpi +openmp:
        default: { variants: +mpi ~openmp }
    - hdf5 +mpi
    - netcdf-c +mpi
    - netcdf-fortran +mpi
    - phylobayesmpi

mpi_lapack_packages:
  metadata:
    section: packages
  pe:
    - gcc_stable
    - intel_stable
  dependencies:
    - mpi
    - blas
  packages:
    - gmsh+openmp+hdf5 ^hdf5+mpi
    - hypre:
        default:
          variants:
            gpu:
              nvidia: +cuda
              none: ~cuda
    - parmetis
    - quantum-espresso+mpi+scalapack
    - quantum-espresso+mpi+scalapack hdf5=parallel ^hdf5+mpi
    - scotch +mpi
    - superlu-dist

mpi_blas_packages:
  metadata:
    section: packages
  pe:
    - gcc_stable
    - intel_stable
  dependencies:
    - mpi
    - blas
    - python
  packages:
    - boost +mpi
    - cgal ^boost+mpi
    - plumed:
        default: { variants: +mpi +gsl }
    - py-h5py ^hdf5 +mpi
    - py-mpi4py

mpi_blas_packages_gcc_stable:
  metadata:
    section: packages
  pe:
    - gcc_stable
  dependencies:
    - mpi
    - blas
  packages:
    - mumps:
        default: { variants: +mpi +parmetis +metis +scotch +ptscotch }
        dependencies:
          - scotch +mpi
          - netlib-scalapack
    - netlib-scalapack

mpi_blas_packages_intel_stable:
  metadata:
    section: packages
  pe:
    - intel_stable
  dependencies:
    - mpi
    - blas
  packages:
    - mumps+mpi+parmetis+metis+scotch+ptscotch

mpi_blas_python_packages:
  metadata:
    section: packages
  pe:
    - gcc_stable
    - intel_stable
  dependencies:
    - mpi
    - blas
    - python
  packages:
    - petsc:
        default:
          variants:
            common: ~int64 +double +hdf5 +metis +mpi +mumps +superlu-dist +hypre +suite-sparse
            gpu:
              nvidia: +cuda
              none: ~cuda
        dependencies:
          - netlib-scalapack
          - hdf5 +mpi
    - slepc:
        default: { variants: +arpack }
    - lammps:
        variants:
          common: build_type=Release +asphere +body +class2 +colloid +compress +coreshell +dipole +granular +kspace +latte +lib +manybody +mc +misc +molecule +mpi +mpiio +peri ~poems +python +qeq  +replica +rigid +shock +snap +srd +user-atc +user-h5md +user-lb +user-misc +user-netcdf +voronoi +plumed
          gpu:
            nvidia: +cuda cuda_arch=<cuda_arch>
            none: ~cuda
        dependencies:
          - netcdf-c+mpi
    - py-petsc4py
